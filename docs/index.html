<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="https://blm-fsmvu.github.io/305/images/icon192.png">
    <title>IBAN Doğrulama</title>
    <style>
        body {
            max-width: 440px;
        }

        #iban {
            width: 270px
        }

        #buttonCustom {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        #out {
            font-size: 19px;
            background: greenyellow;
            color: black;
            text-align: center;
            padding: 15px 15px;
        }
    </style>
</head>

<body>

    <h2 id=title></h2>
    IBAN:
    <input id=iban type=text value="">
    &emsp;
    <input id=buttonCustom type=button value='Kontrol' onClick="report()">
    <input id=buttonCustom type=button value='+' onClick="arttir()">
    <p id=out></p>
    <hr />

    <script>
        "use strict";
        let yeniIbanStr = "";
        function verifyIBAN(s) {
            const ASCII_0 = 48, ASCII_A = 65;
            if (typeof s != 'string') s = String(s)
            const E = /[A-Z]{2}[0-9]{2}[A-Z0-9]+/
            if (!s.match(E)) return false;
            var acc = 0;
            function add(n) {
                if (n == 32) return
                // if (acc > 1000000) acc %= 97;
                acc = n < ASCII_A ? 10 * acc + n - ASCII_0
                    : 100 * acc + n - ASCII_A + 10;
                acc %= 97;
            }
            s = s.substring(4) + s.substring(0, 4)
            for (let i = 0; i < s.length; ++i)
                add(s.charCodeAt(i));
            return acc == 1;
        }

        function report() {
            if (iban.value != "") {
                let v = iban.value.replaceAll(/\s/g, '')
                let t = ''
                t = verifyIBAN(v) === true ? 'IBAN ✓' : 'hatalı'
                out.innerText += '\n' + v + ' ' + t
                console.log(v, t)
            }
        }

        function arttir() {
            yeniIbanStr = ibanDuzenle(iban.value);

            console.log(yeniIban)


        }

        function ibanDuzenle(s) {
            s = s.replaceAll(/\s/g, '');
            let yeniString = "";
            for (let i = 0; i < s.length; ++i) {
                if (s.charCodeAt(i) >= 65 && s.charCodeAt(i) <= 90) {
                    yeniString += (s.charCodeAt(i) - 55)
                } else {
                    yeniString += s.charAt(i);
                }
            }
            return yeniString;
        }

        title.innerText = document.title
        iban.value = ''

    </script>
</body>

</html>